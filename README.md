## 1. プロジェクト概要

**名称**: code2flowchart  
**概要**: プログラミングコードを入力すると、対応するフローチャートを自動生成・可視化するアプリケーション。ユーザーはログインして、生成されたコードとフローチャートのペアを保存・管理できる。

---

## 2. 機能要件

### 2.1 メイン機能

#### 2.1.1 コードからフローチャートを生成

- **入力**:  
   ユーザーが任意のプログラミングコード（主に Python）をエディタ上に入力。
- **処理**:
  - ChatGPT API（Claude Code など）に対して、指定プロンプトを用いてコードを構造解析。
  - プロンプト設計により、コードを「ステップバイステップ」で以下のように変換。
    - コードを処理単位に分割し、それぞれを **ノード（`node`）** として定義。
    - 各ノードを結ぶ **エッジ（`edge`）** を定義し、フロー構造を構築。
- **ChatGPT へのプロンプト（ルール）**（※要件定義に組み込む仕様例）:

```
step by step で実行してください。
- タスク
読み込むコードを処理や文法ごとに分割し、`node`と`node`同士を繋げる`edge`として定義してください。

- nodeについて
分割したコードを基に以下の内容を考察してください。
- id: 0番目から
- title: 分割したコードの一言説明
- code: 分割したコード
- info: 分割したコードの詳細な説明
- type: 分割したコードの属性（if/for/while/unknown/normal）
- position: 初期値は { x: 0, y: 0 }
typeの値について
- if文の場合: 'if'
- for文の場合: 'for'
- while文の場合: 'while'
- 知識に無い不明関数の場合: 'unkown'
- それ以外の場合: normal

nodes = [
  {
    id : int,
    position:{ x: int, y:int },
    data: {
      title: str,
      code: str,
      info: str,
      type: str,
    }
  },
  ...
]

- edgeについて
source: edgeが繋がる基のノードのid
target: edgeが繋がる先のノードのid

edges = [
  {
    source: int,
    target: int,
  },
  ...
]

nodeの出力例
{
  "id": 0,
  "position": { "x": 0, "y": 0 },
  "data": {
    "title": "条件分岐",
    "code": "if x > 0:",
    "info": "xが0より大きい場合の分岐処理です。",
    "type": "if"
  }
}

edgeの出力例
{
  "source": 0,
  "target": 1
}

```

- **出力**:
  - 上記形式の `nodes` と `edges` を JSON で取得。
  - `react-flow` のデータ構造に変換して前処理。

#### 2.1.2 フローチャートの可視化

- **処理**:
  - ChatGPT の出力から、`react-flow` 用のノード・エッジを生成。
  - type（if, for, while, normal など）に応じて色やアイコンを変化させるなど視覚的に判別可能にする。
- **表示**:
  - フローチャートを画面上に描画。ノードの移動・拡大・縮小・再接続など基本的なインタラクションに対応。

### 2.2 サブ機能

#### 2.2.1 ログイン機能

- **認証方式**:
  - JWT またはセッション認証
  - ユーザー登録・ログイン・ログアウト
- **利用目的**:
  - 履歴の個人管理
  - データの永続化と保護

#### 2.2.2 データの保存機能

- **保存内容**:
  - コード（text）
  - フローチャートのノード・エッジ（JSON 構造）
  - タイトル、日付、言語種別などのメタ情報（必要に応じて）
- **保存先**:
  - ユーザー ID に紐づいた MySQL データベース

#### 2.2.3 履歴表示機能（任意）

- **内容**:
  - 自身が過去に生成したコード・フローチャートの一覧表示
  - 「再描画」「削除」「編集」などの操作が可能

#### 2.2.4 構文エラー検出機能（追加）

- **目的**:  
   ユーザーが入力したコードに構文エラーが含まれる場合、ChatGPT API またはフロントエンドで検出・警告表示
- **仕様**:
  - ChatGPT からの返答に基づき、エラー箇所のハイライト（例：赤枠や背景色）
  - 明示的な「ここがエラーです」という説明文表示

### 2.3 フローチャート構造定義（仕様補足）

| 条件           | type 値     |
| -------------- | ----------- |
| if 文          | `"if"`      |
| for 文         | `"for"`     |
| while 文       | `"while"`   |
| 未知な関数など | `"unknown"` |
| その他一般処理 | `"normal"`  |

## 3. 使用技術・ライブラリ

| 分類           | 技術・ライブラリ        | 備考                         |
| -------------- | ----------------------- | ---------------------------- |
| フロントエンド | React, TypeScript       | UI 構築                      |
| UI ライブラリ  | react-flow              | フローチャートの描画         |
| バックエンド   | Python（Flask/FastAPI） | API ルーティング             |
| AI API         | ChatGPT API             | コード解析と構造抽出         |
| DB             | MySQL                   | コードとフローチャートの保存 |
| 認証           | JWT または Flask-Login  | ユーザー認証機能             |

## 4. 画面・コンポーネント一覧（UI 要件）

| 画面名                           | 内容                                                       |
| -------------------------------- | ---------------------------------------------------------- |
| ログイン画面                     | メールアドレス・パスワード入力でログイン                   |
| 登録画面                         | 新規アカウント作成用                                       |
| ダッシュボード画面               | 左に履歴一覧、真ん中にフローチャート表示、右にコード入力   |
| コード入力コンポーネント         | エディタでコード入力 → フローチャート生成                  |
| フローチャート表示コンポーネント | react-flow で描画されたフローチャートの確認・操作          |
| 履歴一覧コンポーネント           | 過去のコード・フローチャートのペアを表示、削除・再描画可能 |

## 5. API 設計

| メソッド | エンドポイント  | 概要                                |
| -------- | --------------- | ----------------------------------- |
| POST     | `/api/login`    | ログイン処理                        |
| POST     | `/api/register` | 新規ユーザー登録                    |
| POST     | `/api/convert`  | コードを ChatGPT API で解析し構造化 |
| GET      | `/api/flows`    | 保存されたフローチャート一覧を取得  |
| GET      | `/api/flow/:id` | 特定のフローチャートを取得          |
| POST     | `/api/flow/:id` | 特定のフローチャートを削除          |
